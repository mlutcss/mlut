@use 'sass:meta';
@use 'sass:string';
@use 'sass-true' as *;
@use 'tools/functions/general' as mlu;
@use 'tools' as mls;

$test-list: (0, 1, 2, 3);

@function -greter-than($item, $i, $n) {
	@return mlu.str2n($item) > $n;
}

@include describe('tools/functions/general') {
	@include describe('remove-nth') {
		@include it('removes element from the list by index') {
			@include assert-equal(
				mlu.remove-nth($test-list, 3),
				0 1 3,
				$inspect: true,
			);

			@include assert-equal(
				mlu.remove-nth($test-list, 8),
				0 1 2 3,
				$inspect: true,
			);
		}

		@include it('wrong type of index argument') {
			@include assert-equal(
				mlu.remove-nth($test-list, '3'),
				'ERROR: Wrong type of argument $index: `string`. Expected `number`',
			);
		}
	}

	@include describe('str-split') {
		@include it('split string into list with separator') {
			@include assert-equal(
				mlu.str-split('text__with__double__underscores', '__'),
				'text' 'with' 'double' 'underscores',
			);

			@include assert-equal(
				mlu.str-split(' one two  3', ' '),
				'' 'one' 'two' '' '3',
			);
		}

		@include it('split string into list without separator') {
			@include assert-equal(
				mlu.str-split('testou'),
				't' 'e' 's' 't' 'o' 'u',
			);
		}

		@include it('split string into list specified number of times') {
			@include assert-equal(
				mlu.str-split('Bgc--bgColor', '-', 1),
				'Bgc' '-bgColor',
			);

			@include assert-equal(
				mlu.str-split('Bgc--bgColor', '-', 0),
				'Bgc--bgColor',
				$inspect: true
			);

			@include assert-equal(
				mlu.str-split('M-a', '-', -5),
				'M-a',
				$inspect: true
			);

			@include assert-equal(
				mlu.str-split('af h,f a fw +:^', ' ', 2),
				'af' 'h,f' 'a fw +:^',
			);

			@include assert-equal(
				mlu.str-split('Bgc--bgColor', $repeats: 3),
				'B' 'g' 'c' '--bgColor',
			);

			@include assert-equal(
				mlu.str-split('testou', $repeats: 12),
				't' 'e' 's' 't' 'o' 'u',
			);

			@include assert-equal(
				mlu.str-split('Red22', $repeats: -1),
				'Red22',
			);
		}
	}

	@include describe('str-trim') {
		@include it('trim trailing and leading whitespaces') {
			@include assert-equal(
				mlu.str-trim('  testou   '),
				'testou',
			);

			@include assert-equal(
				mlu.str-trim('   '),
				'',
			);
		}
	}

	@include describe('str-digit-index') {
		@include it('find the first index of digit in string') {
			@include assert-equal(
				mlu.str-digit-index('Mb55'),
				3,
			);
		}

		@include it('wrong type of argument') {
			@include assert-equal(
				mlu.str-digit-index((55)),
				'ERROR: Wrong type of argument $str: `number`. Expected `string`',
			);
		}

		@include it('digits not found') {
			@include assert-equal(
				mlu.str-digit-index('Mt-a'),
				null,
			);
		}
	}

	@include describe('str-ucfirst') {
		@include it('converts the first letter to uppercase') {
			@include assert-equal(
				mlu.str-ucfirst('fxg1'),
				'Fxg1',
			);
		}

		@include it('wrong type of argument') {
			@include assert-equal(
				mlu.str-ucfirst(1),
				'ERROR: Wrong type of argument $str: `number`. Expected `string`',
			);
		}
	}

	@include describe('str-replace') {
		@include it('replaces substring by another substring') {
			@include assert-equal(
				mlu.str-replace('@:prn BpAll@s BpAll', 'BpAll', 'lg'),
				'@:prn lg@s BpAll',
			);

			@include assert-equal(
				mlu.str-replace('BpAll@s BpAll', 'All'),
				'Bp@s BpAll',
			);
		}
	}

	@include describe('str-replace-all') {
		@include it('replaces all the entries of substring by another substring') {
			@include assert-equal(
				mlu.str-replace-all('BpAll sm@:prn sm@s', 'sm', 'smx'),
				'BpAll smx@:prn smx@s',
			);

			@include assert-equal(
				mlu.str-replace-all('sm@:prn sm@s', 'sm'),
				'@:prn @s',
			);
		}
	}

	@include describe('str-escape') {
		@include it('escape special characters in value') {
			@include assert-equal(
				mlu.str-escape(':^:&::^2:/+a.link:h'),
				'\\:\\^\\:\\&\\:\\:\\^2\\:\\/\\+a\\.link\\:h',
			);

			@include assert-equal(
				mlu.str-escape(1.5),
				'1\\.5',
			);
		}
	}

	@include describe('str-starts') {
		@include it('checks whether the string starts with the substring') {
			@include assert-equal(
				mlu.str-starts('@:prn', '@:'),
				true,
			);

			@include assert-equal(
				mlu.str-starts('BpAll@:scr', '@:'),
				false,
			);

			@include assert-equal(
				mlu.str-starts('xs', 'BpAll'),
				false,
			);

			@include assert-equal(
				mlu.str-starts(22, '2'),
				false,
			);

			@include assert-equal(
				mlu.str-starts('22', 2),
				false,
			);
		}
	}

	@include describe('str2n') {
		@include it('converts string to number with unit') {
			@include assert-equal(
				mlu.str2n('3px'),
				3px,
			);

			@include assert-equal(
				mlu.str2n('3Hz'),
				3hz,
			);

			@include assert-equal(
				mlu.str2n('25p'),
				25p,
			);

			@include assert-equal(
				mlu.str2n('25%'),
				25%,
			);

			@include assert-equal(
				mlu.str2n('-25rem'),
				-25rem,
			);

			@include assert-equal(
				mlu.str2n('3px0'),
				3,
			);
		}

		@include it('returns `null` if not string was passed') {
			@include assert-equal(
				mlu.str2n(#f00),
				null,
			);
		}
	}

	@include describe('str-hex2color') {
		$tests: (
			'converts hex string to color': (
				(red): red,
				('#c06'): #cc0066,
				('#6600cc'): #6600cc,
				('#FAB'): #ffaabb,
			),
			'returns `null` if conversion is not possible': (
				(22): null,
				('red'): null,
			),
			'invalid color format': (
				('#h06'): 'ERROR: Invalid character: `h`. Allowed only hexadecimal digits',
				('#660cc'): 'ERROR: Invalid color format: `#660cc`. Allowed 3 or 6 hexadecimal digits',
			),
		);

		@each $test, $data in $tests {
			@include it($test) {
				@each $args, $expect in $data {
					@include assert-equal(
						mlu.str-hex2color($args...),
						$expect,
						$inspect: true,
					);
				}
			}
		}
	}

	@include describe('ls-implode') {
		$-tests: (
		('xl' ':h' 'D', ' _ ',):  'xl _ :h _ D',
		('e' 'ver' 'more',): 'evermore',
		((),): '',
		(4,): '4',
	);

		@include it('concatenates the elements of the list into a string with separator') {
			@each $args, $expect in $-tests {
				@include assert-equal(
					mlu.ls-implode($args...),
					$expect,
				);
			}
		}
	}

	@include describe('ls-find') {
		$list: (4, '5', 6, '777');

		$-tests: (
			'simple selector after utility': (
				($list, meta.get-function('-greter-than'), 6): '777',
				($list, meta.get-function('-greter-than'), 1000): null,
			),
			'wrong type of argument': (
				($list, 'nope'): 'ERROR: Wrong type of argument $callback: `string`. Expected `function`',
			),
		);

		@each $test, $data in $-tests {
			@include it($test) {
				@each $args, $expect in $data {
					@include assert-equal(
						mlu.ls-find($args...),
						$expect,
						$inspect: true,
					);
				}
			}
		}
	}

	@include describe('is-css-var') {
		$tests: (
			'checks if value is a CSS variable': (
				(var(--bgColor)): true,
				('--bgColor'): false,
			),
			'checks CSS variable in a color': (
				(rgba(var(--mlu-bgColor), 0.6), true): true,
				(hsla(var(--mlu-bgColor), 0.6), true): true,
				(rgb(var(--mlu-bgColor)), true): true,
				(hsl(var(--mlu-bgColor)), true): true,
				(rgb(var(--mlu-bgColor))): false,
				(rgba(24, 0, 102, var(--mlu-bgAlpha)), true): false,

			),
		);

		@each $test, $data in $tests {
			@include it($test) {
				@each $args, $expect in $data {
					@include assert-equal(
						mlu.is-css-var($args...),
						$expect,
					);
				}
			}
		}
	}
}
